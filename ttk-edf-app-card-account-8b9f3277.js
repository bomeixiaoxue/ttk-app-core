webpackJsonp([59,60],{"395":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function config(options){options&&(0,_extends3["default"])(_options,options)}Object.defineProperty(exports,"__esModule",{"value":!0});var _extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_webapi=__webpack_require__(1618),_webapi2=_interopRequireDefault(_webapi),_options={"webapi":_webapi2["default"]};config.current=_options,exports["default"]=config,module.exports=exports["default"]},"666":function(module,exports){"use strict";function getMeta(){return{"name":"root","component":"Layout","className":"ttk-edf-app-card-account","children":[{"name":"bankAccountTypeItem","component":"Form.Item","label":"\u8d26\u6237\u7c7b\u578b","required":!0,"validateStatus":"{{data.other.error.bankAccountType?'error':'success'}}","help":"{{data.other.error.bankAccountType}}","children":{"name":"bankAccountType","component":"Select","showSearch":!1,"disabled":"{{$updateDisabled()}}","value":'{{data.form.bankAccountType && data.form.bankAccountType.id && data.form.bankAccountType.id == 3000050001 ? "\u73b0\u91d1" : data.form.bankAccountType.id}}',"onChange":"{{function(value){$fieldChange('data.form.bankAccountType',data.other.bankAccountType.filter(function(data){return data.id == value})[0])}}}","children":{"name":"option","component":"Select.Option","value":"{{data.other.bankAccountType && data.other.bankAccountType[_rowIndex].id}}","children":"{{data.other.bankAccountType && data.other.bankAccountType[_rowIndex].name }}","_power":"for in data.other.bankAccountType"},"style":{"width":"100%"}}},{"name":"code","component":"Form.Item","label":'{{data.form.bankAccountType && data.form.bankAccountType.name == "\u94f6\u884c" ? "\u8d26\u53f7" : "\u8d26\u6237\u7f16\u7801"}}',"required":!0,"validateStatus":"{{data.other.error.code?'error':'success'}}","help":"{{data.other.error.code}}","children":{"name":"code","component":"Input","disabled":"{{data.form.bankAccountType && data.form.bankAccountType.id == 3000050001}}","maxlength":"50","value":"{{data.form.code}}","onChange":"{{function(e){$sf('data.form.code',e.target.value);$changeCheck(1)}}}"}},{"name":"name","component":"Form.Item","label":'{{data.form.bankAccountType && data.form.bankAccountType.name == "\u94f6\u884c" ? "\u5f00\u6237\u94f6\u884c" : "\u8d26\u6237\u540d\u79f0"}}',"required":!0,"validateStatus":"{{data.other.error.name?'error':'success'}}","help":"{{data.other.error.name}}","children":{"name":"name","component":"Input","disabled":"{{data.form.bankAccountType && data.form.bankAccountType.id == 3000050001}}","maxlength":"20","value":"{{data.form.name}}","onChange":"{{function(e){$sf('data.form.name',e.target.value);$changeCheck()}}}"}},{"name":"openingBalanceItem","component":"Form.Item","validateStatus":"{{data.other.error.beginningBalance?'error':'success'}}","help":"{{data.other.error.beginningBalance}}","label":"\u671f\u521d\u4f59\u989d","children":{"name":"beginningBalance","component":"Input.Number","disabled":"{{data.other.haveMonthlyClosing}}","precision":"2","maxlength":"20","value":"{{data.form.beginningBalance && (data.form.beginningBalance).toFixed(2)}}","onBlur":"{{function(e){$fieldChange('data.form.beginningBalance',e)}}}"}},{"name":"earlyMonthsItem","component":"Form.Item","label":"\u671f\u521d\u6708\u4efd","children":{"name":"earlyMonths","component":"Input.Number","disabled":!0,"maxlength":"20","value":"{{data.form.earlyMonths}}","onChange":"{{function(e){$sf('data.form.earlyMonths',e)}}}"}},{"name":"footer","component":"Layout","children":[{"name":"statusItem","component":"Form.Item","label":"\u505c\u7528","children":[{"name":"isEnable","component":"Checkbox","disabled":"{{data.form.bankAccountType && data.form.bankAccountType.id == 3000050001}}","checked":"{{!data.form.isEnable}}","onChange":"{{function(e){$sf('data.form.isEnable',!e.target.checked)}}}"}]},{"name":"defaultAccountItem","component":"Form.Item","label":"\u9ed8\u8ba4","children":{"name":"isDefault","component":"Checkbox","disabled":"{{data.form.bankAccountType && data.form.bankAccountType.id == 3000050001}}","checked":"{{data.form.isDefault}}","onChange":"{{function(e){$sf('data.form.isDefault',e.target.checked)}}}"}}]}]}}function getInitState(){return{"data":{"form":{"bankAccountType":"","isEnable":!0},"other":{"error":{}}}}}Object.defineProperty(exports,"__esModule",{"value":!0}),exports.getMeta=getMeta,exports.getInitState=getInitState},"1615":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function creator(option){var metaAction=new _edfMetaEngine.action(option),voucherAction=_edfComponent.FormDecorator.actionCreator((0,_extends3["default"])({},option,{"metaAction":metaAction})),o=new action((0,_extends3["default"])({},option,{"metaAction":metaAction,"voucherAction":voucherAction})),ret=(0,_extends3["default"])({},metaAction,voucherAction,o);return metaAction.config({"metaHandlers":ret}),ret}Object.defineProperty(exports,"__esModule",{"value":!0});var _class,_temp,_initialiseProps,_extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_regenerator=__webpack_require__(19),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=__webpack_require__(18),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_classCallCheck2=__webpack_require__(3),_classCallCheck3=_interopRequireDefault(_classCallCheck2);exports["default"]=creator;var _react=__webpack_require__(1),_edfMetaEngine=(_interopRequireDefault(_react),__webpack_require__(5)),_config=__webpack_require__(395),_config2=_interopRequireDefault(_config),_edfComponent=__webpack_require__(22),action=(_temp=_class=function action(option){(0,_classCallCheck3["default"])(this,action),_initialiseProps.call(this),this.metaAction=option.metaAction,this.config=_config2["default"].current,this.voucherAction=option.voucherAction,this.webapi=this.config.webapi},_initialiseProps=function _initialiseProps(){var _this=this;this.onInit=function(_ref){var component=_ref.component,injections=_ref.injections;_this.voucherAction.onInit({"component":component,"injections":injections}),_this.component=component,_this.injections=injections,_this.component.props.setOkListener&&_this.component.props.setOkListener(_this.onOk),injections.reduce("init",{"isPop":_this.component.props.isPop}),_this.load()},this.load=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee(){var data,response,code,currentOrg,accountAttr,haveMonthlyClosing;return _regenerator2["default"].wrap(function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return data={},response={},code=void 0,currentOrg=_this.metaAction.context.get("currentOrg"),_context.next=3,_this.webapi.bankaccount.accountAttr();case 3:if(accountAttr=_context.sent,accountAttr&&(data.accountAttr=accountAttr),!_this.component.props.personId&&0!==_this.component.props.personId){_context.next=11;break}return _context.next=8,_this.webapi.bankaccount.query(_this.component.props.personId);case 8:response=_context.sent,_context.next=14;break;case 11:return _context.next=13,_this.webapi.bankaccount.getCode();case 13:code=_context.sent;case 14:return _context.next=16,_this.webapi.bankaccount.haveMonthlyClosing({});case 16:haveMonthlyClosing=_context.sent,data.haveMonthlyClosing=haveMonthlyClosing,code&&(data.code=code),response&&(data.response=response),data.enabledTime=currentOrg.enabledYear+"-"+currentOrg.enabledMonth,_this.injections.reduce("load",data);case 22:case"end":return _context.stop()}},_callee,_this)})),this.onOk=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee2(){return _regenerator2["default"].wrap(function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,_this.save();case 2:return _context2.abrupt("return",_context2.sent);case 3:case"end":return _context2.stop()}},_callee2,_this)})),this.updateDisabled=function(){var status=!1;return(_this.component.props.personId||0===_this.component.props.personId)&&(status=!0),status},this.save=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee3(){var form,id,ok,response,option;return _regenerator2["default"].wrap(function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return form=_this.metaAction.gf("data.form").toJS(),id=_this.component.props.id,_context3.next=4,_this.voucherAction.check([{"path":"data.form.bankAccountType","value":form.bankAccountType},{"path":"data.form.code","value":form.code},{"path":"data.form.name","value":form.name},{"path":"data.form.beginningBalance","value":form.beginningBalance}],_this.check);case 4:if(ok=_context3.sent){_context3.next=8;break}return _this.metaAction.toast("warning","\u8bf7\u6309\u9875\u9762\u63d0\u793a\u4fe1\u606f\u4fee\u6539\u4fe1\u606f\u540e\u624d\u53ef\u63d0\u4ea4"),_context3.abrupt("return",!1);case 8:if(response=void 0,option={"bankAccountTypeId":form.bankAccountType.id,"isDefault":form.isDefault,"isEnable":form.isEnable},option.code=form.code?form.code.trim():"",option.name=form.name?form.name.trim():"",option.bankName=form.bankName?form.bankName:"",option.ts=form.ts?form.ts:"",option.beginningBalance=form.beginningBalance||0==form.beginningBalance||""==form.beginningBalance?form.beginningBalance:"",form.bankAccountType&&delete form.bankAccountType,option.isReturnValue=!0,!_this.component.props.personId&&0!==_this.component.props.personId){_context3.next=23;break}return option.id=_this.component.props.personId,_context3.next=20,_this.webapi.bankaccount.update(option);case 20:response=_context3.sent,_context3.next=26;break;case 23:return _context3.next=25,_this.webapi.bankaccount.create(option);case 25:response=_context3.sent;case 26:if(!response||!response.error){_context3.next=31;break}return _this.metaAction.toast("error",response.error.message),_context3.abrupt("return",!1);case 31:return _this.metaAction.toast("success","\u4fdd\u5b58\u6210\u529f"),_context3.abrupt("return",response);case 33:case"end":return _context3.stop()}},_callee3,_this)})),this.changeCheck=function(num){var form=_this.metaAction.gf("data.form").toJS();1==num?_this.voucherAction.check([{"path":"data.form.code","value":form.code}],_this.check):_this.voucherAction.check([{"path":"data.form.name","value":form.name}],_this.check)},this.check=function(option){if(option&&option.path)return"data.form.bankAccountType"==option.path?{"errorPath":"data.other.error.bankAccountType","message":option.value&&option.value.id?"":"\u8bf7\u5f55\u5165\u8d26\u6237\u7c7b\u578b"}:"data.form.code"==option.path?{"errorPath":"data.other.error.code","message":option.value&&option.value.trim()?"":"\u8bf7\u5f55\u5165\u7f16\u7801"}:"data.form.name"==option.path?{"errorPath":"data.other.error.name","message":option.value&&option.value.trim()?"":"\u8bf7\u5f55\u5165\u5f00\u6237\u94f6\u884c\u540d\u79f0"}:"data.form.beginningBalance"==option.path&&option.value?{"errorPath":"data.other.error.beginningBalance","message":option.value>1e12||option.value<-1e12?"\u6700\u5927\u6574\u6570\u4f4d\u4e3a12\u4f4d":""}:void 0},this.fieldChange=function(path,value){_this.voucherAction.fieldChange(path,value,_this.check)}},_temp);module.exports=exports["default"]},"1616":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{"value":!0}),exports["default"]=void 0;var _dec,_class,_extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_classCallCheck2=__webpack_require__(3),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=__webpack_require__(7),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(6),_inherits3=_interopRequireDefault(_inherits2),_react=__webpack_require__(1),_edfMetaEngine=(_interopRequireDefault(_react),__webpack_require__(5)),_index=__webpack_require__(667),_index2=_interopRequireDefault(_index),C=(_dec=(0,_edfMetaEngine.wrapper)(_index2["default"]),_dec(_class=function(_Component){function C(){return(0,_classCallCheck3["default"])(this,C),(0,_possibleConstructorReturn3["default"])(this,_Component.apply(this,arguments))}return(0,_inherits3["default"])(C,_Component),C.prototype.render=function render(){return this.props.monkeyKing((0,_extends3["default"])({},this.props,{"path":"root"}))},C}(_react.Component))||_class);exports["default"]=C,module.exports=exports["default"]},"1617":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function creator(option){var metaReducer=new _edfMetaEngine.reducer(option),o=new reducer((0,_extends3["default"])({},option,{"metaReducer":metaReducer}));return(0,_extends3["default"])({},metaReducer,o)}Object.defineProperty(exports,"__esModule",{"value":!0});var _class,_temp,_initialiseProps,_extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_keys=__webpack_require__(41),_keys2=_interopRequireDefault(_keys),_classCallCheck2=__webpack_require__(3),_classCallCheck3=_interopRequireDefault(_classCallCheck2);exports["default"]=creator;var _immutable=__webpack_require__(11),_edfMetaEngine=__webpack_require__(5),_config=__webpack_require__(395),_config2=_interopRequireDefault(_config),_data=__webpack_require__(666),reducer=(_temp=_class=function reducer(option){(0,_classCallCheck3["default"])(this,reducer),_initialiseProps.call(this),this.metaReducer=option.metaReducer,this.config=_config2["default"].current},_initialiseProps=function _initialiseProps(){var _this=this;this.init=function(state,option){var initState=(0,_data.getInitState)();return _this.metaReducer.init(state,initState)},this.load=function(state,option){return option.response&&(option.response&&(0==(0,_keys2["default"])(option.response).length?(option.response.isEnable=!0,state=_this.metaReducer.sf(state,"data.form",(0,_immutable.fromJS)(option.response)),state=_this.metaReducer.sf(state,"data.form.bankAccountType.id","")):state=_this.metaReducer.sf(state,"data.form",(0,_immutable.fromJS)(option.response))),option.response.bankAccountTypeId&&(state=_this.metaReducer.sf(state,"data.form.bankAccountType",(0,_immutable.fromJS)({"id":option.response.bankAccountTypeId,"name":option.response.bankAccountTypeName})))),state=_this.metaReducer.sf(state,"data.other.haveMonthlyClosing",(0,_immutable.fromJS)(option.haveMonthlyClosing)),option.code&&(state=_this.metaReducer.sf(state,"data.form.code",(0,_immutable.fromJS)(option.code))),option.accountAttr&&(state=_this.metaReducer.sf(state,"data.other.bankAccountType",(0,_immutable.fromJS)(option.accountAttr))),option.enabledTime&&(state=_this.metaReducer.sf(state,"data.form.earlyMonths",(0,_immutable.fromJS)(option.enabledTime))),state}},_temp);module.exports=exports["default"]},"1618":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{"value":!0});var _edfUtils=__webpack_require__(12);exports["default"]={"bankaccount":{"getCode":function getCode(){return _edfUtils.fetch.post("/v1/ba/basearchive/getAutoCode",{"archiveName":"ba_bank_account"})},"query":function query(id){return _edfUtils.fetch.post("/v1/ba/bankAccount/query",{"id":id})},"create":function create(option){return _edfUtils.fetch.post("/v1/ba/bankAccount/create",option)},"update":function update(option){return _edfUtils.fetch.post("/v1/ba/bankAccount/update",option)},"accountAttr":function accountAttr(option){return _edfUtils.fetch.post("/v1/ba/bankAccount/queryBankAccountType",option)},"haveMonthlyClosing":function haveMonthlyClosing(option){return _edfUtils.fetch.post("/v1/gl/mec/haveMonthlyClosing",option)},"queryList":function queryList(option){return _edfUtils.fetch.post("v1/ba/bankAccount/queryList",option)}}},module.exports=exports["default"]}});