webpackJsonp([18,60],{"408":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function config(options){options&&(0,_extends3["default"])(_options,options)}Object.defineProperty(exports,"__esModule",{"value":!0});var _extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_webapi=__webpack_require__(1671),_webapi2=_interopRequireDefault(_webapi),_options={"webapi":_webapi2["default"]};config.current=_options,exports["default"]=config,module.exports=exports["default"]},"692":function(module,exports){"use strict";function getMeta(){return{"name":"root","component":"Layout","className":"ttk-edf-app-company-manage","children":[{"name":"btnGroup","component":"div","_visible":"{{data.hideBackBtn}}","className":"ttk-edf-app-company-manage-back","children":[{"name":"back","component":"Button","children":"\u8fd4\u56de","onClick":"{{$back}}","className":"ttk-edf-app-company-manage-back-btn"}]},{"name":"header2","component":"div","className":"ttk-edf-app-company-manage-header","children":[{"name":"btnGroup1","component":"div","children":[{"name":"list","component":"div","children":"\u4f01\u4e1a\u5217\u8868","className":"ttk-edf-app-company-manage-header-company-btn"}]},{"name":"Search","component":"Input.Search","onChange":"{{function(e){$fieldChange('data.form.name',e.target.value)}}}","onFocus":"{{$manageBlur}}","className":"ttk-edf-app-company-manage-header-search","placeholder":"\u4f01\u4e1a\u540d\u79f0"},{"name":"btnGroup2","component":"Layout","className":"ttk-edf-app-company-manage-header-right","children":[{"name":"new","component":"Button","children":"\u521b\u5efa\u4f01\u4e1a","onClick":"{{$addManage}}","className":"ttk-edf-app-company-manage-header-right-btn"}]}]},{"name":"content","component":"div","className":"ttk-edf-app-company-manage-content","children":[{"name":"dataGrid","component":"DataGrid","headerHeight":36,"isColumnResizing":!0,"loading":"{{data.other.loading}}","rowHeight":36,"lineHeight":36,"ellipsis":!0,"rowsCount":"{{$getListRowsCount()}}","columns":"{{$getListColumns()}}"}]}]}}function getInitState(){return{"data":{"hideBackBtn":!1,"list":[],"manageList":[],"form":{},"pagination":{"current":1,"total":0,"pageSize":20},"columns":[]}}}Object.defineProperty(exports,"__esModule",{"value":!0}),exports.getMeta=getMeta,exports.getInitState=getInitState},"1663":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function creator(option){var metaAction=new _edfMetaEngine.action(option),extendAction=_extend2["default"].actionCreator((0,_extends3["default"])({},option,{"metaAction":metaAction})),o=new action((0,_extends3["default"])({},option,{"metaAction":metaAction,"extendAction":extendAction})),ret=(0,_extends3["default"])({},metaAction,extendAction.gridAction,o);return metaAction.config({"metaHandlers":ret}),ret}Object.defineProperty(exports,"__esModule",{"value":!0});var _class,_temp,_initialiseProps,_extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_regenerator=__webpack_require__(19),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=__webpack_require__(18),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_classCallCheck2=__webpack_require__(3),_classCallCheck3=_interopRequireDefault(_classCallCheck2);exports["default"]=creator;var _react=__webpack_require__(1),_react2=_interopRequireDefault(_react),_edfMetaEngine=__webpack_require__(5),_edfComponent=__webpack_require__(22),_extend=__webpack_require__(1669),_extend2=_interopRequireDefault(_extend),_config=__webpack_require__(408),_config2=_interopRequireDefault(_config),_edfConsts=__webpack_require__(133),action=(__webpack_require__(12),_temp=_class=function action(option){(0,_classCallCheck3["default"])(this,action),_initialiseProps.call(this),this.metaAction=option.metaAction,this.extendAction=option.extendAction,this.config=_config2["default"].current,this.webapi=this.config.webapi},_initialiseProps=function _initialiseProps(){var _this=this;this.onInit=function(_ref){var component=_ref.component,injections=_ref.injections;_this.extendAction.gridAction.onInit({"component":component,"injections":injections}),_this.component=component,_this.injections=injections,injections.reduce("init");var availableOrg=sessionStorage.getItem("currentOrgStatus");1!=availableOrg&&2!=availableOrg&&_this.metaAction.sf("data.hideBackBtn",!0),_this.isCurrentOrg=!1,_this.load()},this.load=function(){var _ref2=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee(option){var column,list,_response,availableOrg,response,_response2;return _regenerator2["default"].wrap(function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _this.metaAction.sf("data.other.loading",!0),column=_this.getColumns(),_context.next=4,_this.getData();case 4:if(list=_context.sent,!_this.isCurrentOrg||0==list.length){_context.next=10;break}return _context.next=8,_this.webapi.org.updateCurrentOrg({"orgId":list[0].id});case 8:_response=_context.sent,document.querySelector(".currentOrgName").innerHTML=list[0].name;case 10:if(availableOrg=sessionStorage.getItem("currentOrgStatus"),response=void 0,1==availableOrg||2==availableOrg){_context.next=21;break}return _context.next=15,_this.webapi.portal.init();case 15:return _context.next=17,_this.webapi.portal.portal();case 17:_response2=_context.sent,option&&(_response2.org=option),_response2.user?_this.metaAction.context.set("currentUser",_response2.user):(_this.metaAction.context.set("currentUser",void 0),_this.component.props.onRedirect&&_this.config.goAfterLogout&&_this.component.props.onRedirect(_this.config.goAfterLogout)),_response2.org?_this.metaAction.context.set("currentOrg",_response2.org):(_this.metaAction.context.set("currentOrg",void 0),_this.component.props.onRedirect&&_this.config.goAfterLogout&&_this.component.props.onRedirect(_this.config.goAfterLogout));case 21:if(0!=list.length){_context.next=30;break}return _this.injections.reduce("load",column,list),_this.injections.reduce("initQueryList",list),_this.metaAction.sf("data.isShowSearch",!1),sessionStorage["currentOrgStatus"]=2,_this.metaAction.sf("data.hideBackBtn",!1),_this.component.props.hideHead(),_this.metaAction.sf("data.other.loading",!1),_context.abrupt("return");case 30:_this.injections.reduce("load",column,list),_this.injections.reduce("initQueryList",list),_this.metaAction.sf("data.isShowSearch",!1),_this.metaAction.sf("data.other.loading",!1);case 34:case"end":return _context.stop()}},_callee,_this)}));return function(_x){return _ref2.apply(this,arguments)}}(),this.addManage=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee2(){return _regenerator2["default"].wrap(function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:_this.component.props.setPortalContent("\u65b0\u5efa\u4f01\u4e1a","ttk-edf-app-company-manage-add");case 1:case"end":return _context2.stop()}},_callee2,_this)})),this.manageBlur=function(){},this.manageResearch=function(e){},this.goRegister=function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),_this.component.props.onRedirect({"appName":"ttk-edf-app-company-manage-add"})},this.goCompanyManage=function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),_this.component.props.onRedirect({"appName":"ttk-edf-app-company-manage"})},this.fieldChange=function(path,value){var column=(_this.metaAction.gf("data.form").toJS(),_this.getColumns()),searchList=[],res=_this.metaAction.gf("data.queryList").toJS();res.map(function(option,index){return option.name.indexOf(value)>-1&&searchList.push(option),searchList}),""==value?_this.injections.reduce("load",column,res):_this.injections.reduce("load",column,searchList)},this.getListColumns=function(){var Column=_edfComponent.DataGrid.Column,Cell=_edfComponent.DataGrid.Cell,columns=_this.metaAction.gf("data.columns").toJS(),list=[];_this.metaAction.gf("data.list")&&(list=_this.metaAction.gf("data.list").toJS());var cols=[];return columns.forEach(function(op){var col=_react2["default"].createElement(Column,{"name":op.id,"isResizable":!1,"columnKey":op.id,"flexGrow":1,"width":"name"==op.name||"remark"==op.name?"name"==op.name?270:70:150,"header":_react2["default"].createElement(Cell,{"name":"header","className":"ttk-edf-app-company-manage-headerBgColor"},op.columnName),"cell":function cell(ps){if("lastLoginTime"==op.name)return _react2["default"].createElement(Cell,null,""+list[ps.rowIndex]["lastLoginTime"]);if("contactNumber"==op.name)return _react2["default"].createElement(Cell,null,list[ps.rowIndex]["createTime"].replace(/-/g,".")+"-"+list[ps.rowIndex]["expireTime"].replace(/-/g,"."));if("status"==op.name)return list[ps.rowIndex]["status"]==_edfConsts.consts.ORGTATUS_001?_react2["default"].createElement(Cell,null,"\u6b63\u5e38"):list[ps.rowIndex]["status"]==_edfConsts.consts.ORGTATUS_002?_react2["default"].createElement(Cell,null,"\u8fc7\u671f"):_react2["default"].createElement(Cell,null,"\u8bd5\u7528\u671f");if("remark"==op.name){var isOtherUser=list[ps.rowIndex].isOtherUser;return _react2["default"].createElement(Cell,null,_react2["default"].createElement("span",{"href":"javascript:","className":"ttk-edf-app-company-manage-font","onClick":1==isOtherUser?"":_this.delOrg.bind(_this,list[ps.rowIndex].id)},_react2["default"].createElement(_edfComponent.Icon,{"disabled":isOtherUser,"type":"shanchu","fontFamily":"edficon","style":{"fontSize":"24px"}})))}var name=list[ps.rowIndex][op.name];return _react2["default"].createElement(Cell,{"className":"portalOrgName","title":name,"onClick":function onClick(){_this.setCurrentOrg(list[ps.rowIndex])}}," ",name)}});cols.push(col)}),cols},this.back=function(){_this.component.props.setPortalContent("\u95e8\u6237\u9996\u9875","ttk-edf-app-portal",{"isShowMenu":!1,"isTabsStyle":!1})},this.getListRowsCount=function(){var list=_this.metaAction.gf("data.list");return list?list.size:0},this.isCurrentOrg=!1,this.delOrg=function(){var _ref4=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee3(id){var data,ret,response;return _regenerator2["default"].wrap(function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return data=_this.metaAction.context.get("currentOrg"),_context3.next=3,_this.metaAction.modal("confirm",{"title":"\u5220\u9664","content":"\u5220\u9664\u4f01\u4e1a\u5c06\u6c38\u4e45\u5220\u9664\u8be5\u4f01\u4e1a\u76f8\u5173\u7684\u6570\u636e\uff0c\u65e0\u6cd5\u6062\u590d\uff0c\u8bf7\u8c28\u614e\u64cd\u4f5c\u3002\u60a8\u786e\u8ba4\u8981\u5220\u9664\u4f01\u4e1a\u5417?","className":"ttk-edf-app-company-manage-modal"});case 3:if(ret=_context3.sent,!ret){_context3.next=12;break}return _context3.next=7,_this.webapi.org.del({"id":id});case 7:response=_context3.sent,response&&(_this.component.props.updateOrgList(),_this.metaAction.toast("success","\u5220\u9664\u6210\u529f"),id==data.id?_this.isCurrentOrg=!0:_this.isCurrentOrg=!1),_this.load(),_context3.next=13;break;case 12:return _context3.abrupt("return");case 13:case"end":return _context3.stop()}},_callee3,_this)}));return function(_x2){return _ref4.apply(this,arguments)}}(),this.setCurrentOrg=function(){var _ref5=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee4(option){var response;return _regenerator2["default"].wrap(function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,_this.webapi.org.updateCurrentOrg({"orgId":option.id});case 2:if(response=_context4.sent,sessionStorage["currentOrgStatus"]=null,_context4.t0=_this.component.props.onPortalReload,!_context4.t0){_context4.next=8;break}return _context4.next=8,_this.component.props.onPortalReload();case 8:_this.metaAction.context.set("currentOrg",option),_this.component.props.setPortalContent("\u95e8\u6237\u9996\u9875","ttk-edf-app-portal",{"isShowMenu":!1,"isTabsStyle":!1});case 10:case"end":return _context4.stop()}},_callee4,_this)}));return function(_x3){return _ref5.apply(this,arguments)}}(),this.modifyDetail=function(id){return function(e){var personId=id?id:null;_this.add(personId)}},this.getData=function(){var _ref6=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee5(pageInfo){var response;return _regenerator2["default"].wrap(function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,_this.webapi.org.queryList();case 2:return response=_context5.sent,_context5.abrupt("return",response);case 4:case"end":return _context5.stop()}},_callee5,_this)}));return function(_x4){return _ref6.apply(this,arguments)}}(),this.getColumns=function(){return[{"columnName":"\u4f01\u4e1a\u540d\u79f0","id":"name","name":"name"},{"columnName":"\u4f7f\u7528\u72b6\u6001","id":"status","name":"status"},{"columnName":"\u6700\u540e\u767b\u5f55\u65e5\u671f","id":"lastLoginTime","name":"lastLoginTime"},{"columnName":"\u6388\u6743\u65e5\u671f","id":"contactNumber","name":"contactNumber"},{"columnName":"\u64cd\u4f5c","id":"remark","name":"remark"}]}},_temp);module.exports=exports["default"]},"1668":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{"value":!0}),exports["default"]=void 0;var _dec,_class,_extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_classCallCheck2=__webpack_require__(3),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=__webpack_require__(7),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(6),_inherits3=_interopRequireDefault(_inherits2),_react=__webpack_require__(1),_edfMetaEngine=(_interopRequireDefault(_react),__webpack_require__(5)),_index=__webpack_require__(693),_index2=_interopRequireDefault(_index),C=(_dec=(0,_edfMetaEngine.wrapper)(_index2["default"]),_dec(_class=function(_Component){function C(){return(0,_classCallCheck3["default"])(this,C),(0,_possibleConstructorReturn3["default"])(this,_Component.apply(this,arguments))}return(0,_inherits3["default"])(C,_Component),C.prototype.render=function render(){return this.props.monkeyKing((0,_extends3["default"])({},this.props,{"path":"root"}))},C}(_react.Component))||_class);exports["default"]=C,module.exports=exports["default"]},"1669":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function getGridOption(){return{"details":{"path":"data.list","cellClassName":"app-archives-list-cell","emptyRow":{},"getColNames":function getColNames(gf){return[]},"cellIsReadonly":function cellIsReadonly(cellPosition,path,gf){return!1}}}}function actionCreator(option){return{"gridAction":new _edfComponent.GridDecorator.action((0,_extends3["default"])({},option,{"gridOption":getGridOption()}))}}function reducerCreator(option){return{"gridReducer":new _edfComponent.GridDecorator.reducer((0,_extends3["default"])({},option,{"gridOption":getGridOption()}))}}Object.defineProperty(exports,"__esModule",{"value":!0});var _extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_edfComponent=__webpack_require__(22);exports["default"]={"actionCreator":actionCreator,"reducerCreator":reducerCreator},module.exports=exports["default"]},"1670":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function creator(option){var metaReducer=new _edfMetaEngine.reducer(option),o=new reducer((0,_extends3["default"])({},option,{"metaReducer":metaReducer}));return(0,_extends3["default"])({},metaReducer,o)}Object.defineProperty(exports,"__esModule",{"value":!0});var _extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_classCallCheck2=__webpack_require__(3),_classCallCheck3=_interopRequireDefault(_classCallCheck2);exports["default"]=creator;var _immutable=__webpack_require__(11),_edfMetaEngine=__webpack_require__(5),_config=__webpack_require__(408),_config2=_interopRequireDefault(_config),_data=__webpack_require__(692),reducer=function reducer(option){var _this=this;(0,_classCallCheck3["default"])(this,reducer),this.init=function(state,option){var initState=(0,_data.getInitState)();return _this.metaReducer.init(state,initState)},this.load=function(state,columns,value){return state=_this.metaReducer.sf(state,"data.columns",(0,_immutable.fromJS)(columns)),value&&(state=_this.metaReducer.sf(state,"data.list",(0,_immutable.fromJS)(value))),state},this.initQueryList=function(state,value){return state=_this.metaReducer.sf(state,"data.queryList",(0,_immutable.fromJS)(value))},this.metaReducer=option.metaReducer,this.config=_config2["default"].current};module.exports=exports["default"]},"1671":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{"value":!0});var _edfUtils=__webpack_require__(12);exports["default"]={"portal":{"init":function init(){return _edfUtils.fetch.post("/v1/edf/portal/init")},"portal":function portal(){return _edfUtils.fetch.post("/v1/edf/portal/getPortalDto").then(function(r){return r.menu.forEach(function(m){return m.key=m.code}),r.menu=_edfUtils.tree.build(r.menu,{"id":0}).children,r})}},"user":{"logout":function logout(){return _edfUtils.fetch.post("/v1/edf/user/logout")}},"org":{"queryList":function queryList(option){return _edfUtils.fetch.post("v1/edf/sysOrg/queryListForOrgManage",option)},"del":function del(option){return _edfUtils.fetch.post("/v1/edf/org/delete",option)},"updateCurrentOrg":function updateCurrentOrg(option){return _edfUtils.fetch.post("/v1/edf/org/updateCurrentOrg",option)}}},module.exports=exports["default"]}});