webpackJsonp([32,60],{"430":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function config(options){options&&(0,_extends3["default"])(_options,options)}Object.defineProperty(exports,"__esModule",{"value":!0});var _extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_webapi=__webpack_require__(1760),_webapi2=_interopRequireDefault(_webapi),_options={"webapi":_webapi2["default"]};config.current=_options,exports["default"]=config,module.exports=exports["default"]},"736":function(module,exports){"use strict";function getMeta(){return{"name":"root","component":"Layout","className":"ttk-edf-app-operation","onMouseDown":"{{$mousedown}}","children":[{"name":"header","component":"Layout","className":"ttk-edf-app-operation-header","children":[{"name":"save","component":"Button","type":"primary","onClick":"{{$save}}","children":"\u4fdd\u5b58"}]},{"name":"table","component":"DataGrid","headerHeight":40,"rowsCount":"{{data.list.length}}","rowHeight":40,"readonly":!1,"enableSequence":!0,"enableAddDelrow":!0,"startSequence":1,"onAddrow":"{{$addrow}}","onDelrow":"{{$delrow}}","columns":[{"name":"id","component":"DataGrid.Column","columnKey":"id","flexGrow":1,"width":100,"header":{"name":"header","component":"DataGrid.Cell","className":"ttk-edf-app-operation-tableHeader","children":"ID"},"cell":{"name":"cell","component":"DataGrid.TextCell","className":"{{$getCellClassName(_ctrlPath)}}","value":"{{data.list[_rowIndex].id}}","_power":"({rowIndex})=>rowIndex"}},{"name":"name","component":"DataGrid.Column","columnKey":"name","flexGrow":1,"width":100,"header":{"name":"header","component":"DataGrid.Cell","className":"ttk-edf-app-operation-tableHeaderNoBoder","children":"\u540d\u79f0"},"cell":{"name":"cell","component":"{{$isFocus(_ctrlPath) ? 'Input' : 'DataGrid.TextCell'}}","className":"{{$getCellClassName(_ctrlPath)}}","value":"{{data.list[_rowIndex].name}}","onChange":"{{function(e){$sf('data.list.' + _rowIndex + '.name', e.target.value)}}}","_power":"({rowIndex})=>rowIndex"}},{"name":"parentId","component":"DataGrid.Column","columnKey":"parentId","flexGrow":1,"width":100,"header":{"name":"header","component":"DataGrid.Cell","className":"ttk-edf-app-operation-tableHeader","children":"\u4e0a\u7ea7"},"cell":{"name":"cell","component":"{{$isFocus(_ctrlPath) ? 'Select' : 'DataGrid.TextCell'}}","className":"{{$getCellClassName(_ctrlPath)}}","value":"{{data.list[_rowIndex].parentId}}","onChange":"{{function(v){$sf('data.list.' + _rowIndex + '.parentId', v)}}}","_power":"({rowIndex})=>rowIndex"}},{"name":"isEndNode","component":"DataGrid.Column","columnKey":"isEndNode","flexGrow":1,"width":100,"header":{"name":"header","component":"DataGrid.Cell","className":"ttk-edf-app-operation-tableHeader","children":"\u672b\u7ea7"},"cell":{"name":"cell","component":"{{$isFocus(_ctrlPath) ? 'Select' : 'DataGrid.TextCell'}}","className":"{{$getCellClassName(_ctrlPath)}}","showSearch":!1,"value":"{{{\n\t\t\t\t\t\tif(!data.list[_rowIndex].isEndNode) return undefined\n\t\t\t\t\t\treturn $isFocus(_ctrlPath)\n\t\t\t\t\t\t\t? data.list[_rowIndex].isEndNode\n\t\t\t\t\t\t\t: (data.list[_rowIndex].isEndNode == 1 ? '\u662f' : '\u5426')\n\t\t\t\t\t}}}","onChange":"{{function(v){$sf('data.list.'+ _rowIndex + '.isEndNode', v)}}}","_excludeProps":"{{$isFocus(_ctrlPath)? ['onClick'] : ['children'] }}","_power":"({rowIndex})=>rowIndex","children":[{"name":"yes","component":"Select.Option","value":"1","children":"\u662f"},{"name":"no","component":"Select.Option","value":"0","children":"\u5426"}]}}]}]}}function getInitState(){return{"data":{"list":[],"other":{}}}}Object.defineProperty(exports,"__esModule",{"value":!0}),exports.getMeta=getMeta,exports.getInitState=getInitState},"1757":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function creator(option){var metaAction=new _edfMetaEngine.action(option),o=new action((0,_extends3["default"])({},option,{"metaAction":metaAction})),ret=(0,_extends3["default"])({},metaAction,o);return metaAction.config({"metaHandlers":ret}),ret}Object.defineProperty(exports,"__esModule",{"value":!0});var _extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_regenerator=__webpack_require__(19),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=__webpack_require__(18),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_classCallCheck2=__webpack_require__(3),_classCallCheck3=_interopRequireDefault(_classCallCheck2);exports["default"]=creator;var _react=__webpack_require__(1),_reactDom=(_interopRequireDefault(_react),__webpack_require__(16)),_reactDom2=_interopRequireDefault(_reactDom),_edfMetaEngine=__webpack_require__(5),_config=__webpack_require__(430),_config2=_interopRequireDefault(_config),_moment=(__webpack_require__(22),__webpack_require__(11),__webpack_require__(14)),_edfUtils=(_interopRequireDefault(_moment),__webpack_require__(12)),_edfUtils2=_interopRequireDefault(_edfUtils),colKeys=["id","name","parentId","dependentId","isEndNode"],action=function(){function action(option){var _this=this;(0,_classCallCheck3["default"])(this,action),this.onInit=function(_ref){var component=_ref.component,injections=_ref.injections;_this.component=component,_this.injections=injections,injections.reduce("init"),_this.load()},this.load=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee(){var response;return _regenerator2["default"].wrap(function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,_this.webapi.operation.query({});case 2:response=_context.sent,_this.injections.reduce("load",response);case 4:case"end":return _context.stop()}},_callee,_this)})),this.save=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee2(){var list;return _regenerator2["default"].wrap(function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return list=_this.metaAction.gf("data.list").toJS(),_context2.next=3,_this.webapi.operation.save(list);case 3:_this.metaAction.toast("success","\u4fdd\u5b58\u6210\u529f"),_this.load();case 5:case"end":return _context2.stop()}},_callee2,_this)})),this.addrow=function(ps){_this.injections.reduce("addEmptyRow",ps.rowIndex+1)},this.delrow=function(ps){var list=_this.metaAction.gf("data.list"),id=list.getIn([ps.rowIndex,"id"]);_this.injections.reduce("delrow",id)},this.mousedown=function(e){var path=_edfUtils2["default"].path.findPathByEvent(e);if(!_this.metaAction.isFocus(path))if(path.indexOf("cell.cell")!=-1)_this.focusCell(_this.getCellInfo(path));else{if(!_this.metaAction.focusByEvent(e))return;setTimeout(_this.cellAutoFocus,16)}},this.cellAutoFocus=function(){_edfUtils2["default"].dom.gridCellAutoFocus(_this.component,".editable-cell")},this.getCellClassName=function(path){return _this.metaAction.isFocus(path)?"ttk-edf-app-operation-cell editable-cell":""},this.isFocusCell=function(ps,columnKey){var focusCellInfo=_this.metaAction.gf("data.other.focusCellInfo");return!!focusCellInfo&&(focusCellInfo.columnKey==columnKey&&focusCellInfo.rowIndex==ps.rowIndex)},this.gridBirthdayOpenChange=function(status){if(!status){var editorDOM=_reactDom2["default"].findDOMNode(_this.component).querySelector(".editable-cell");if(editorDOM&&editorDOM.className.indexOf("datepicker")!=-1){var input=editorDOM.querySelector("input");input.focus()}}},this.metaAction=option.metaAction,this.config=_config2["default"].current,this.webapi=this.config.webapi}return action.prototype.getCellInfo=function getCellInfo(path){var parsedPath=_edfUtils2["default"].path.parsePath(path),rowCount=this.metaAction.gf("data.list").size,colCount=4,colKey=parsedPath.path.replace("root.children.table.columns.","").replace(".cell.cell","").replace(/\s/g,"");return{"x":colKeys.findIndex(function(o){return o==colKey}),"y":Number(parsedPath.vars[0]),"colCount":colCount,"rowCount":rowCount}},action.prototype.focusCell=function focusCell(position){this.metaAction.sfs({"data.other.focusFieldPath":"root.children.table.columns."+colKeys[position.x]+".cell.cell,"+position.y,"data.other.scrollToRow":position.y,"data.other.scrollToColumn":position.x}),setTimeout(this.cellAutoFocus,16)},action}();module.exports=exports["default"]},"1758":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{"value":!0}),exports["default"]=void 0;var _dec,_class,_extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_classCallCheck2=__webpack_require__(3),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=__webpack_require__(7),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(6),_inherits3=_interopRequireDefault(_inherits2),_react=__webpack_require__(1),_edfMetaEngine=(_interopRequireDefault(_react),__webpack_require__(5)),_index=__webpack_require__(737),_index2=_interopRequireDefault(_index),C=(_dec=(0,_edfMetaEngine.wrapper)(_index2["default"]),_dec(_class=function(_Component){function C(){return(0,_classCallCheck3["default"])(this,C),(0,_possibleConstructorReturn3["default"])(this,_Component.apply(this,arguments))}return(0,_inherits3["default"])(C,_Component),C.prototype.render=function render(){return this.props.monkeyKing((0,_extends3["default"])({},this.props,{"path":"root"}))},C}(_react.Component))||_class);exports["default"]=C,module.exports=exports["default"]},"1759":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function creator(option){var metaReducer=new _edfMetaEngine.reducer(option),o=new reducer((0,_extends3["default"])({},option,{"metaReducer":metaReducer}));return(0,_extends3["default"])({},metaReducer,o)}Object.defineProperty(exports,"__esModule",{"value":!0});var _extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_classCallCheck2=__webpack_require__(3),_classCallCheck3=_interopRequireDefault(_classCallCheck2);exports["default"]=creator;var _immutable=__webpack_require__(11),_edfMetaEngine=__webpack_require__(5),_config=__webpack_require__(430),_config2=_interopRequireDefault(_config),_data=__webpack_require__(736),_moment=__webpack_require__(14),reducer=(_interopRequireDefault(_moment),function reducer(option){var _this=this;(0,_classCallCheck3["default"])(this,reducer),this.init=function(state,option){var initState=(0,_data.getInitState)();return _this.metaReducer.init(state,initState)},this.load=function(state,response){return state=_this.metaReducer.sf(state,"data.list",(0,_immutable.fromJS)(response)),_this.metaReducer.sf(state,"data.other.focusCellInfo",void 0)},this.addEmptyRow=function(state,rowIndex){var list=_this.metaReducer.gf(state,"data.list");return list=list.insert(rowIndex,(0,_immutable.Map)({"id":list.size})),_this.metaReducer.sf(state,"data.list",list)},this.delrow=function(state,id){var list=_this.metaReducer.gf(state,"data.list"),index=list.findIndex(function(o){return o.get("id")==id});return index==-1?state:(list=list.remove(index),_this.metaReducer.sf(state,"data.list",list))},this.metaReducer=option.metaReducer,this.config=_config2["default"].current});module.exports=exports["default"]},"1760":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{"value":!0});var _edfUtils=__webpack_require__(12);exports["default"]={"operation":{"query":function query(option){return _edfUtils.fetch.post("/v1/edf/operation/query",option)},"save":function save(list){return _edfUtils.fetch.post("/v1/edf/operation/save",list)}}},module.exports=exports["default"]}});