webpackJsonp([28,58],{"432":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function config(options){options&&(0,_extends3["default"])(_options,options)}Object.defineProperty(exports,"__esModule",{"value":!0});var _extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_webapi=__webpack_require__(1761),_webapi2=_interopRequireDefault(_webapi),_options={"webapi":_webapi2["default"]};config.current=_options,exports["default"]=config,module.exports=exports["default"]},"738":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function getMeta(){return{"name":"root","component":"Layout","className":"edfx-app-tree-table-detail","children":[{"name":"form","component":"Form","className":"edfx-app-tree-table-detail-form","children":[{"name":"codeItem","component":"Form.Item","label":"\u7f16\u7801","required":!0,"validateStatus":"{{data.other.error.code?'error':'success'}}","help":"{{data.other.error.code}}","children":[{"name":"code","component":"Input","value":"{{data.form.code}}","onChange":"{{function(e){$fieldChange('data.form.code',e.target.value)}}}"}]},{"name":"nameItem","component":"Form.Item","label":"\u540d\u79f0","required":!0,"validateStatus":"{{data.other.error.name?'error':'success'}}","help":"{{data.other.error.name}}","children":[{"name":"name","component":"Input","value":"{{data.form.name}}","onChange":"{{function(e){$fieldChange('data.form.name',e.target.value)}}}"}]},{"name":"appNameItem","component":"Form.Item","label":"\u5e94\u7528\u540d\u79f0","children":[{"name":"appName","component":"Input","value":"{{data.form.appName}}","onChange":"{{function(e){$fieldChange('data.form.appName',e.target.value)}}}"}]},{"name":"parentItem","component":"Form.Item","label":"\u4e0a\u7ea7\u83dc\u5355","children":[{"name":"option","component":"Select","showSearch":!1,"allowClear":!0,"value":"{{data.form.parentId ? data.form.parentId: undefined }}","onChange":"{{$parentMenuChange}}","onFocus":"{{$parentMenuFocus}}","children":{"name":"option","component":"Select.Option","value":"{{ data.other.parents ? data.other.parents[_rowIndex].id : undefined}}","children":"{{data.other.parents ? data.other.parents[_rowIndex].name : undefined}}","_power":"for in data.other.parents"}}]},{"name":"showOrderItem","component":"Form.Item","label":"\u663e\u793a\u987a\u5e8f","children":[{"name":"showOrder","component":"Input","value":"{{data.form.showOrder}}","onChange":"{{function(e){$fieldChange('data.form.showOrder',e.target.value)}}}"}]},{"name":"operations","component":"Form.Item","label":"\u529f\u80fd\u6743\u9650","children":[{"name":"cb","component":"Checkbox.Group","options":"{{data.other.options}}","value":"{{data.other.selectedOperations}}","onChange":"{{$selectOperations}}"}]}]}]}}function getInitState(){var state={"data":{"form":{"name":""},"other":{"error":{}}}};return state}Object.defineProperty(exports,"__esModule",{"value":!0}),exports.getMeta=getMeta,exports.getInitState=getInitState;var _moment=__webpack_require__(14);_interopRequireDefault(_moment)},"1758":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function creator(option){var metaAction=new _edfMetaEngine.action(option),o=new action((0,_extends3["default"])({},option,{"metaAction":metaAction})),ret=(0,_extends3["default"])({},metaAction,o);return metaAction.config({"metaHandlers":ret}),ret}Object.defineProperty(exports,"__esModule",{"value":!0});var _extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_getIterator2=__webpack_require__(28),_getIterator3=_interopRequireDefault(_getIterator2),_regenerator=__webpack_require__(20),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=__webpack_require__(19),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_classCallCheck2=__webpack_require__(3),_classCallCheck3=_interopRequireDefault(_classCallCheck2);exports["default"]=creator;var _react=__webpack_require__(1),_edfMetaEngine=(_interopRequireDefault(_react),__webpack_require__(5)),_immutable=__webpack_require__(11),_moment=__webpack_require__(14),_config=(_interopRequireDefault(_moment),__webpack_require__(432)),_config2=_interopRequireDefault(_config),action=function(){function action(option){var _this=this;(0,_classCallCheck3["default"])(this,action),this.gf=function(field){var value=_this.metaAction.gf(field);return value=value&&value.toJS()||null},this.onInit=function(_ref){var component=_ref.component,injections=_ref.injections;_this.component=component,_this.injections=injections,_this.component.props.setOkListener&&_this.component.props.setOkListener(_this.onOk),_this.loadOperations(),_this.component.props.id?(injections.reduce("init"),_this.load()):injections.reduce("init",{"parentId":_this.component.props.parentId}),_this.parentMenuFocus()},this.load=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee(){var response,operationIds;return _regenerator2["default"].wrap(function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,_this.webapi.menu.findFullById(_this.component.props.id);case 2:response=_context.sent,operationIds=response.operations&&response.operations.map(function(o){return o.operationId}),_this.selectOperations(operationIds),_this.injections.reduce("load",response);case 6:case"end":return _context.stop()}},_callee,_this)})),this.loadOperations=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee2(){var operations,options;return _regenerator2["default"].wrap(function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,_this.webapi.operation.query({});case 2:operations=_context2.sent,options=operations.map(function(o){return{"label":o.name,"value":o.id}}),_this.injections.reduce("loadOperations",{"operations":operations,"options":options});case 5:case"end":return _context2.stop()}},_callee2,_this)})),this.onOk=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee3(){return _regenerator2["default"].wrap(function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,_this.save();case 2:return _context3.abrupt("return",_context3.sent);case 3:case"end":return _context3.stop()}},_callee3,_this)})),this.save=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee4(){var form,ok,operationIds,operations,response,_response;return _regenerator2["default"].wrap(function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return form=_this.metaAction.gf("data.form").toJS(),_context4.next=3,_this.check([{"path":"data.form.name","value":form.name},{"path":"data.form.code","value":form.code}]);case 3:if(ok=_context4.sent){_context4.next=6;break}return _context4.abrupt("return",!1);case 6:if(operationIds=_this.gf("data.other.selectedOperations")||[],operations=operationIds.map(function(oid){var mo={"menuId":form.id,"operationId":oid};if(form.operations){var operation=form.operations.find(function(m){return m.operationId==oid});operation&&(mo.id=operation.id)}return mo}),form.operations=operations,form.parentId=void 0==form.parentId?0:form.parentId,!form.id){_context4.next=18;break}return _context4.next=13,_this.webapi.menu.update(form);case 13:return response=_context4.sent,_this.metaAction.toast("success","\u4fee\u6539\u6210\u529f"),_context4.abrupt("return",response);case 18:return _context4.next=20,_this.webapi.menu.create(form);case 20:return _response=_context4.sent,_this.metaAction.toast("success","\u65b0\u589e\u6210\u529f"),_context4.abrupt("return",_response);case 23:case"end":return _context4.stop()}},_callee4,_this)})),this.fieldChange=function(){var _ref6=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee5(fieldPath,value){return _regenerator2["default"].wrap(function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,_this.check([{"path":fieldPath,"value":value}]);case 2:case"end":return _context5.stop()}},_callee5,_this)}));return function(_x,_x2){return _ref6.apply(this,arguments)}}(),this.check=function(){var _ref7=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee6(fieldPathAndValues){var checkResults,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,o,r,json,hasError;return _regenerator2["default"].wrap(function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(fieldPathAndValues){_context6.next=2;break}return _context6.abrupt("return");case 2:checkResults=[],_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0,_context6.prev=6,_iterator=(0,_getIterator3["default"])(fieldPathAndValues);case 8:if(_iteratorNormalCompletion=(_step=_iterator.next()).done){_context6.next=31;break}if(o=_step.value,r=(0,_extends3["default"])({},o),"data.form.nickname"!=o.path){_context6.next=20;break}return _context6.t0=_extends3["default"],_context6.t1=r,_context6.next=16,_this.checkName(o.value);case 16:_context6.t2=_context6.sent,(0,_context6.t0)(_context6.t1,_context6.t2),_context6.next=27;break;case 20:if("data.form.code"!=o.path){_context6.next=27;break}return _context6.t3=_extends3["default"],_context6.t4=r,_context6.next=25,_this.checkCode(o.value);case 25:_context6.t5=_context6.sent,(0,_context6.t3)(_context6.t4,_context6.t5);case 27:checkResults.push(r);case 28:_iteratorNormalCompletion=!0,_context6.next=8;break;case 31:_context6.next=37;break;case 33:_context6.prev=33,_context6.t6=_context6["catch"](6),_didIteratorError=!0,_iteratorError=_context6.t6;case 37:_context6.prev=37,_context6.prev=38,!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]();case 40:if(_context6.prev=40,!_didIteratorError){_context6.next=43;break}throw _iteratorError;case 43:return _context6.finish(40);case 44:return _context6.finish(37);case 45:return json={},hasError=!0,checkResults.forEach(function(o){json[o.path]=o.value,json[o.errorPath]=o.message,o.message&&(hasError=!1)}),_this.metaAction.sfs(json),_context6.abrupt("return",hasError);case 50:case"end":return _context6.stop()}},_callee6,_this,[[6,33,37,45],[38,,40,44]])}));return function(_x3){return _ref7.apply(this,arguments)}}(),this.checkCode=function(){var _ref8=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee7(code){var message;return _regenerator2["default"].wrap(function _callee7$(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return code||(message="\u8bf7\u5f55\u5165\u7f16\u7801"),_context7.abrupt("return",{"errorPath":"data.other.error.code","message":message});case 2:case"end":return _context7.stop()}},_callee7,_this)}));return function(_x4){return _ref8.apply(this,arguments)}}(),this.checkName=function(){var _ref9=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee8(name){var message;return _regenerator2["default"].wrap(function _callee8$(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return name||(message="\u8bf7\u5f55\u5165\u540d\u79f0"),_context8.abrupt("return",{"errorPath":"data.other.error.name","message":message});case 2:case"end":return _context8.stop()}},_callee8,_this)}));return function(_x5){return _ref9.apply(this,arguments)}}(),this.selectOperations=function(curIds){var operations=_this.gf("data.operations")||[],preIds=_this.gf("data.other.selectedOperations")||[];if(preIds.length>curIds.length){var clearIds=preIds.filter(function(preId){return!curIds.find(function(id){return id==preId})});curIds=_this.clearSubOperation(curIds,clearIds,operations)}else curIds=_this.addDependentOperation(curIds,operations);_this.injections.reduce("selectOperations",curIds)},this.parentMenuFocus=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee9(){var response;return _regenerator2["default"].wrap(function _callee9$(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:return _context9.next=2,_this.webapi.menu.query({});case 2:response=_context9.sent,_this.metaAction.sf("data.other.parents",(0,_immutable.fromJS)(response));case 4:case"end":return _context9.stop()}},_callee9,_this)})),this.parentMenuChange=function(v){var menuDataSource=_this.metaAction.gf("data.other.parents"),menu=menuDataSource.find(function(o){return o.get("id")==v});_this.metaAction.sf("data.form.parent",menu),_this.metaAction.sf("data.form.parentId",menu.get("id"))},this.metaAction=option.metaAction,this.config=_config2["default"].current,this.webapi=this.config.webapi}return action.prototype.addDependentOperation=function addDependentOperation(ids,operations){for(var _loop=function _loop(i){var id=ids[i],op=operations.find(function(o){return o.id==id&&o.dependentId});op&&!ids.find(function(theid){return theid==op.dependentId})&&ids.push(op.dependentId)},i=0;i<ids.length;i++)_loop(i);return ids},action.prototype.clearSubOperation=function clearSubOperation(curIds,clearIds,operations){for(var _loop2=function _loop2(i){var id=clearIds[i];operations.filter(function(op){return op.dependentId==id}).forEach(function(op){var index=curIds.findIndex(function(theid){return theid==op.id});index!=-1&&delete curIds[index],clearIds.find(function(cid){return cid==op.id})||clearIds.push(op.id)})},i=0;i<clearIds.length;i++)_loop2(i);return curIds.filter(function(id){return id})},action}();module.exports=exports["default"]},"1759":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{"value":!0}),exports["default"]=void 0;var _dec,_class,_extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_classCallCheck2=__webpack_require__(3),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=__webpack_require__(7),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(6),_inherits3=_interopRequireDefault(_inherits2),_react=__webpack_require__(1),_edfMetaEngine=(_interopRequireDefault(_react),__webpack_require__(5)),_index=__webpack_require__(739),_index2=_interopRequireDefault(_index),C=(_dec=(0,_edfMetaEngine.wrapper)(_index2["default"]),_dec(_class=function(_Component){function C(){return(0,_classCallCheck3["default"])(this,C),(0,_possibleConstructorReturn3["default"])(this,_Component.apply(this,arguments))}return(0,_inherits3["default"])(C,_Component),C.prototype.render=function render(){return this.props.monkeyKing((0,_extends3["default"])({},this.props,{"path":"root"}))},C}(_react.Component))||_class);exports["default"]=C,module.exports=exports["default"]},"1760":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function creator(option){var metaReducer=new _edfMetaEngine.reducer(option),o=new reducer((0,_extends3["default"])({},option,{"metaReducer":metaReducer}));return(0,_extends3["default"])({},metaReducer,o)}Object.defineProperty(exports,"__esModule",{"value":!0});var _class,_temp,_initialiseProps,_extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_classCallCheck2=__webpack_require__(3),_classCallCheck3=_interopRequireDefault(_classCallCheck2);exports["default"]=creator;var _immutable=__webpack_require__(11),_edfMetaEngine=__webpack_require__(5),_config=__webpack_require__(432),_moment=(_interopRequireDefault(_config),__webpack_require__(14)),_data=(_interopRequireDefault(_moment),__webpack_require__(738)),reducer=(_temp=_class=function reducer(option){(0,_classCallCheck3["default"])(this,reducer),_initialiseProps.call(this),this.metaReducer=option.metaReducer},_initialiseProps=function _initialiseProps(){var _this=this;this.init=function(state,option){var initState=(0,_data.getInitState)();return option&&option.parentId&&(initState.data.form.parentId=option.parentId),_this.metaReducer.init(state,initState)},this.load=function(state,response){return _this.metaReducer.sf(state,"data.form",(0,_immutable.fromJS)(response))},this.loadOperations=function(state,_ref){var operations=_ref.operations,options=_ref.options;return state=_this.metaReducer.sf(state,"data.other.options",(0,_immutable.fromJS)(options)),_this.metaReducer.sf(state,"data.operations",(0,_immutable.fromJS)(operations))},this.selectOperations=function(state,operationIds){return _this.metaReducer.sf(state,"data.other.selectedOperations",(0,_immutable.fromJS)(operationIds))}},_temp);module.exports=exports["default"]},"1761":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{"value":!0});var _edfUtils=__webpack_require__(12);exports["default"]={"menu":{"create":function create(option){return _edfUtils.fetch.post("/v1/edf/menu/create",option)},"update":function update(option){return _edfUtils.fetch.post("/v1/edf/menu/update",option)},"query":function query(option){return _edfUtils.fetch.post("/v1/edf/menu/query",option)},"findFullById":function findFullById(id){return _edfUtils.fetch.post("/v1/edf/menu/findFullById",id)}},"operation":{"query":function query(option){return _edfUtils.fetch.post("/v1/edf/operation/query",option)}}},module.exports=exports["default"]}});