webpackJsonp([27,60],{"437":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function config(options){options&&(0,_extends3["default"])(_options,options)}Object.defineProperty(exports,"__esModule",{"value":!0});var _extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_webapi=__webpack_require__(1789),_webapi2=_interopRequireDefault(_webapi),_options={"webapi":_webapi2["default"]};config.current=_options,exports["default"]=config,module.exports=exports["default"]},"750":function(module,exports){"use strict";function getMeta(){return{"name":"root","component":"Layout","className":"ttk-edf-app-role-auth","children":[{"name":"left","component":"Card","className":"ttk-edf-app-role-auth-left","title":"\u89d2\u8272","extra":{"name":"header","component":"div","children":[{"name":"add","component":"Button","icon":"plus","onClick":"{{$addRole}}"},{"name":"modify","component":"Button","icon":"edit","onClick":"{{$modifyRole}}"},{"name":"delete","component":"Button","icon":"close","onClick":"{{$delRole}}"}]},"children":[{"name":"menu","component":"Menu","selectedKeys":"{{[data.other && data.other.filter.roleId+'']}}","onSelect":"{{$selectRole}}","children":"{{$loopMenuChildren(data.roles)}}"}]},{"name":"content","component":"Card","className":"ttk-edf-app-role-auth-content","title":"\u6743\u9650","children":[{"name":"dataGrid","component":"DataGrid","className":"","headerHeight":35,"rowHeight":35,"enableSequence":!0,"startSequence":1,"rowsCount":"{{$getListRowsCount()}}","columns":"{{$getOperationColumns()}}"}]}]}}function getInitState(){return{"data":{"roles":[],"menus":[],"operations":[],"other":{"filter":{}}}}}Object.defineProperty(exports,"__esModule",{"value":!0}),exports.getMeta=getMeta,exports.getInitState=getInitState},"1786":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function creator(option){var metaAction=new _edfMetaEngine.action(option),o=new action((0,_extends3["default"])({},option,{"metaAction":metaAction})),ret=(0,_extends3["default"])({},metaAction,o);return metaAction.config({"metaHandlers":ret}),ret}Object.defineProperty(exports,"__esModule",{"value":!0});var _extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_regenerator=__webpack_require__(19),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=__webpack_require__(18),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_classCallCheck2=__webpack_require__(3),_classCallCheck3=_interopRequireDefault(_classCallCheck2);exports["default"]=creator;var _react=__webpack_require__(1),_react2=_interopRequireDefault(_react),_edfMetaEngine=__webpack_require__(5),_config=(__webpack_require__(11),__webpack_require__(437)),_config2=_interopRequireDefault(_config),_moment=__webpack_require__(14),_edfComponent=(_interopRequireDefault(_moment),__webpack_require__(22)),action=function action(option){var _this=this;(0,_classCallCheck3["default"])(this,action),this.onInit=function(_ref){var component=_ref.component,injections=_ref.injections;_this.component=component,_this.injections=injections,injections.reduce("init"),_this.init()},this.init=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee(){var response;return _regenerator2["default"].wrap(function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,_this.webapi.role.init();case 2:response=_context.sent,response.operations.forEach(function(op){op.count=0,response.menus.forEach(function(m){var count=m.operations?m.operations.filter(function(mop){return mop.operationId==op.id}).length:0;op.count+=count})}),response.filter={"roleId":response.roles.length&&response.roles[0].id},_this.injections.reduce("loadInit",response);case 6:case"end":return _context.stop()}},_callee,_this)})),this.getOperationColumns=function(){var roleId=_this.metaAction.gf("data.other.filter.roleId"),operations=_this.metaAction.gf("data.operations").toJS(),menus=_this.metaAction.gf("data.menus").toJS(),menuOperations=_this.metaAction.gf("data.menuOperations");menuOperations=menuOperations?menuOperations.toJS():[];var Column=_edfComponent.DataGrid.Column,Cell=_edfComponent.DataGrid.Cell,cols=[_react2["default"].createElement(Column,{"name":"name","columnKey":"name","flexGrow":1,"width":200,"header":_react2["default"].createElement(Cell,{"name":"header"},"\u83dc\u5355"),"cell":function cell(ps){return _react2["default"].createElement(Cell,{"align":"center"},(0!=menus[ps.rowIndex].parentId,""+menus[ps.rowIndex].name))}})];return operations.forEach(function(op){var col=_react2["default"].createElement(Column,{"name":op.id,"columnKey":op.id,"flexGrow":1,"width":200,"header":_react2["default"].createElement(Cell,{"name":"header"},_react2["default"].createElement(_edfComponent.Checkbox,{"disabled":!roleId,"checked":_this.isSelectedAll(op,menuOperations),"onChange":_this.selectAll(op)},op.name)),"cell":function cell(ps){var m=menus[ps.rowIndex],menuEnableOps=m.operations||[{"operationId":0}];if(!m.appName||"null"==m.appName||!menuEnableOps.find(function(m){return m.operationId==op.id}))return _react2["default"].createElement(Cell,null);var checked=!!menuOperations.find(function(mo){return mo.menuId==m.id&&mo.operationId==op.id});return _react2["default"].createElement(Cell,null,_react2["default"].createElement(_edfComponent.Checkbox,{"disabled":!roleId,"checked":checked,"onChange":_this.selectOperation(m,op)}))}});cols.push(col)}),cols},this.isSelectedAll=function(op,menuOperations){return op.count==menuOperations.filter(function(o){return o&&o.operationId==op.id}).length},this.loadRole=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee2(){var filter,menuOperations;return _regenerator2["default"].wrap(function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return filter=_this.metaAction.gf("data.other.filter").toJS(),_context2.next=3,_this.init(filter);case 3:return _context2.next=5,_this.webapi.roleMenuOperation.query(filter);case 5:menuOperations=_context2.sent,_this.injections.reduce("loadRoleMenuOperation",{"menuOperations":menuOperations,"filter":filter});case 7:case"end":return _context2.stop()}},_callee2,_this)})),this.getListRowsCount=function(){return _this.metaAction.gf("data.menus").size},this.selectRole=function(){var _ref4=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee3(_ref5){var filter,menuOperations,selectedKeys=_ref5.selectedKeys;return _regenerator2["default"].wrap(function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(filter={"roleId":selectedKeys[0]},0!=selectedKeys.length){_context3.next=4;break}return _this.injections.reduce("loadRoleMenuOperation",{"menuOperations":[],"filter":filter}),_context3.abrupt("return");case 4:return _context3.next=6,_this.webapi.roleMenuOperation.query(filter);case 6:menuOperations=_context3.sent,_this.injections.reduce("loadRoleMenuOperation",{"menuOperations":menuOperations,"filter":filter});case 8:case"end":return _context3.stop()}},_callee3,_this)}));return function(_x){return _ref4.apply(this,arguments)}}(),this.selectAll=function(operation){return function(e){var menus=_this.metaAction.gf("data.menus").toJS(),menuOperations=_this.updateOperation(menus,operation,e.target.checked);_this.injections.reduce("loadRoleMenuOperation",{"menuOperations":menuOperations});var _metaAction$gf$toJS=_this.metaAction.gf("data.other.filter").toJS(),roleId=_metaAction$gf$toJS.roleId;_this.webapi.roleMenuOperation.save({"roleId":roleId,"menuOperations":menuOperations})}},this.selectOperation=function(menu,operation){return function(e){var menuOperations=_this.updateOperation([menu],operation,e.target.checked);_this.injections.reduce("loadRoleMenuOperation",{"menuOperations":menuOperations});var _metaAction$gf$toJS2=_this.metaAction.gf("data.other.filter").toJS(),roleId=_metaAction$gf$toJS2.roleId;_this.webapi.roleMenuOperation.save({"roleId":roleId,"menuOperations":menuOperations})}},this.updateOperation=function(menus,operation,selected,menuOperations,callstackIds){if(callstackIds&&operation){if(1==callstackIds["_"+operation.id])return;callstackIds["_"+operation.id]=!0}var roleId=_this.metaAction.gf("data.other.filter.roleId"),operations=_this.metaAction.gf("data.operations").toJS();menuOperations=menuOperations||_this.metaAction.gf("data.menuOperations")||[],menuOperations&&menuOperations.toJS&&(menuOperations=menuOperations.toJS());var dependedOperations=operations.filter(function(op){return op.id==operation.dependentId}),subOperations=operations.filter(function(op){return op.dependentId==operation.id});return menus.forEach(function(menu){var theOpIndex=menuOperations.findIndex(function(mo){return mo&&mo.menuId==menu.id&&mo.operationId==operation.id});selected&&theOpIndex==-1?(menu.operations&&menu.operations.find(function(mo){return mo.operationId==operation.id})&&menuOperations.push({"menuId":menu.id,"operationId":operation.id,"roleId":roleId}),dependedOperations.forEach(function(depOp){return _this.updateOperation([menu],depOp,selected,menuOperations,callstackIds||{})})):selected||theOpIndex==-1||(delete menuOperations[theOpIndex],subOperations.forEach(function(subOp){return _this.updateOperation([menu],subOp,selected,menuOperations,callstackIds||{})}))}),menuOperations.filter(function(mo){return mo})},this.loopMenuChildren=function(data){return data&&data.map(function(_ref6){var id=_ref6.id,name=_ref6.name;return _react2["default"].createElement(_edfComponent.Menu.Item,{"key":id},name)})},this.addRole=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee4(){var ret;return _regenerator2["default"].wrap(function _callee4$(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,_this.metaAction.modal("show",{"title":"\u65b0\u589e","children":_this.metaAction.loadApp("ttk-edf-app-role",{"store":_this.component.props.store})});case 2:ret=_context4.sent,ret&&_this.loadRole();case 4:case"end":return _context4.stop()}},_callee4,_this)})),this.modifyRole=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee5(){var id,ret;return _regenerator2["default"].wrap(function _callee5$(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(id=_this.metaAction.gf("data.other.filter.roleId")){_context5.next=4;break}return _this.metaAction.toast("error","\u8bf7\u9009\u4fee\u6539\u9879"),_context5.abrupt("return");case 4:return _context5.next=6,_this.metaAction.modal("show",{"title":"\u4fee\u6539","children":_this.metaAction.loadApp("ttk-edf-app-role",{"store":_this.component.props.store,"id":id})});case 6:ret=_context5.sent,ret&&_this.loadRole();case 8:case"end":return _context5.stop()}},_callee5,_this)})),this.delRole=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function _callee6(){var id,ret,response;return _regenerator2["default"].wrap(function _callee6$(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(id=_this.metaAction.gf("data.other.filter.roleId")){_context6.next=4;break}return _this.metaAction.toast("error","\u8bf7\u9009\u5220\u9664\u9879"),_context6.abrupt("return");case 4:return _context6.next=6,_this.metaAction.modal("confirm",{"title":"\u5220\u9664","content":"\u786e\u8ba4\u5220\u9664?"});case 6:if(ret=_context6.sent,!ret){_context6.next=13;break}return _context6.next=10,_this.webapi.role["delete"]({"id":id});case 10:response=_context6.sent,_this.metaAction.toast("success","\u5220\u9664\u7c7b\u578b\u6210\u529f"),_this.init();case 13:case"end":return _context6.stop()}},_callee6,_this)})),this.metaAction=option.metaAction,this.config=_config2["default"].current,this.webapi=this.config.webapi};module.exports=exports["default"]},"1787":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{"value":!0}),exports["default"]=void 0;var _dec,_class,_extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_classCallCheck2=__webpack_require__(3),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_possibleConstructorReturn2=__webpack_require__(7),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=__webpack_require__(6),_inherits3=_interopRequireDefault(_inherits2),_react=__webpack_require__(1),_edfMetaEngine=(_interopRequireDefault(_react),__webpack_require__(5)),_index=__webpack_require__(751),_index2=_interopRequireDefault(_index),C=(_dec=(0,_edfMetaEngine.wrapper)(_index2["default"]),_dec(_class=function(_Component){function C(){return(0,_classCallCheck3["default"])(this,C),(0,_possibleConstructorReturn3["default"])(this,_Component.apply(this,arguments))}return(0,_inherits3["default"])(C,_Component),C.prototype.render=function render(){return this.props.monkeyKing((0,_extends3["default"])({},this.props,{"path":"root"}))},C}(_react.Component))||_class);exports["default"]=C,module.exports=exports["default"]},"1788":function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function creator(option){var metaReducer=new _edfMetaEngine.reducer(option),o=new reducer((0,_extends3["default"])({},option,{"metaReducer":metaReducer}));return(0,_extends3["default"])({},metaReducer,o)}Object.defineProperty(exports,"__esModule",{"value":!0});var _extends2=__webpack_require__(2),_extends3=_interopRequireDefault(_extends2),_from=__webpack_require__(247),_from2=_interopRequireDefault(_from),_classCallCheck2=__webpack_require__(3),_classCallCheck3=_interopRequireDefault(_classCallCheck2);exports["default"]=creator;var _immutable=__webpack_require__(11),_edfMetaEngine=__webpack_require__(5),_config=__webpack_require__(437),_data=(_interopRequireDefault(_config),__webpack_require__(750)),reducer=function reducer(option){var _this=this;(0,_classCallCheck3["default"])(this,reducer),this.init=function(state,option){return _this.metaReducer.init(state,(0,_data.getInitState)())},this.loadInit=function(state,response){return state=_this.metaReducer.sf(state,"data.roles",(0,_immutable.fromJS)(response.roles)),state=_this.metaReducer.sf(state,"data.menus",(0,_immutable.fromJS)(response.menus)),state=_this.metaReducer.sf(state,"data.operations",(0,_immutable.fromJS)(response.operations)),state=_this.metaReducer.sf(state,"data.menuOperations",(0,_immutable.fromJS)(response.menuOperations)),state=_this.metaReducer.sf(state,"data.other.filter",(0,_immutable.fromJS)(response.filter))},this.loadRole=function(state,response){return state=_this.metaReducer.sf(state,"data.roles",(0,_immutable.fromJS)(response))},this.loadRoleMenuOperation=function(state,_ref){var menuOperations=_ref.menuOperations,filter=_ref.filter;return state=_this.metaReducer.sf(state,"data.menuOperations",(0,_immutable.fromJS)((0,_from2["default"])(menuOperations))),filter&&(state=_this.metaReducer.sf(state,"data.other.filter",(0,_immutable.fromJS)(filter))),state},this.metaReducer=option.metaReducer};module.exports=exports["default"]},"1789":function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{"value":!0});var _edfUtils=__webpack_require__(12);exports["default"]={"roleMenuOperation":{"query":function query(option){return _edfUtils.fetch.post("/v1/edf/roleMenuOperation/query",option)},"save":function save(option){return _edfUtils.fetch.post("/v1/edf/roleMenuOperation/save",option)}},"role":{"init":function init(option){return _edfUtils.fetch.post("/v1/edf/role/init",option)},"query":function query(option){return _edfUtils.fetch.post("/v1/edf/role/query",option)},"delete":function _delete(option){return _edfUtils.fetch.post("/v1/edf/role/delete",option)}}},module.exports=exports["default"]}});